# axual_application_deployment (Resource)

An Application Deployment stores the configs for 'Connector' or 'Ksml' application type that is saved for an Application on an Environment.


## Usage
- To see the required configuration parameters for each connect-plugin (`axual_application.application_class`), refer to the documentation: [Axual Connect Plugins Catalog](https://docs.axual.io/connect/Axual-Connect/developer/connect-plugins-catalog/connect-plugins-catalog.html).
- Creating the `axual_application_deployment` resource automatically starts the application.
- Updating the `axual_application_deployment` resource automatically stops the application (if it is running), applies the update, and then restarts it.
- Deleting the `axual_application_deployment` resource automatically stops the application (if it is running) before removing it.
- For more information about connector applications in Axual, refer to the documentation: [Starting Connectors](https://docs.axual.io/connect/Axual-Connect/developer/starting-connectors.html).
- Currently, a data source for `axual_application_deployment` is not supported.

### Design Decision: Use of `depends_on`
- Ensure the use of the `depends_on` attribute as shown in the example below. This guarantees that Terraform creates the required `axual_application_access_grant_approval` resource before creating `axual_application_deployment` resource.
- We use the `depends_on` attribute because each connector plugin determines the topic names it should use in its own way. By explicitly specifying `depends_on`, the connector owner can protect the deployment until the necessary approvals are in place. Due to the dynamic nature of Connect, this structure is necessary to maintain flexibility and control over the resource creation process.

## Required Roles
- APPLICATION_ADMIN or be part of the Team that owns the Application

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `application` (String) A valid Uid of an existing application
- `environment` (String) A valid Uid of an existing environment

### Optional

- `configs` (Map of String, Sensitive) Connector config for Application Deployment. Required for Connector deployments. This field is Sensitive and will not be displayed in server log outputs when using Terraform commands. All available application plugin class names, plugin types and plugin configs are listed here in API- `GET: /api/connect_plugins?page=0&size=9999&sort=pluginClass` and in Axual Connect Docs: https://docs.axual.io/connect/Axual-Connect/developer/connect-plugins-catalog/connect-plugins-catalog.html
- `definition` (String, Sensitive) KSML definition for Application Deployment. Required for KSML deployments. This field is Sensitive and will not be displayed in server log outputs when using Terraform commands.
- `deployment_size` (String) The deployment size for KSML applications. Optional for KSML deployments. If not specified, the Platform Manager will assign a default value.
- `restart_policy` (String) The restart policy for KSML applications. Valid values are 'on_exit' and 'never'. Required for KSML deployments.

### Read-Only

- `id` (String) The ID of this resource.
- `type` (String) The type of application deployment. This is automatically set based on the application's type.

## Example Usage

```hcl
resource "axual_application_deployment" "connector_axual_application_deployment" {
  environment =  "09412f2ac3cb436598c68f5822ec3572"
  application = axual_application.connector_test_application.id
  configs = {
    "logger.name" = "tflogger",
    "throughput" = "10",
    "topic" = "tf-testing-source-1-2",
    "key.converter" = "StringConverter",
    "value.converter" = "StringConverter",
    "header.converter" = "",
    "config.action.reload" = "restart",
    "tasks.max" = "1",
    "errors.log.include.messages" = "false",
    "errors.log.enable" = "false",
    "errors.retry.timeout" = "0",
    "errors.retry.delay.max.ms" = "60000",
    "errors.tolerance" = "none",
    "predicates" = "",
    "topic.creation.groups" = "",
    "transforms" = ""
  }
  depends_on = [
    axual_application_access_grant_approval.connector_axual_application_access_grant_approval-logsource-1,
  ]
}
```

For a full example which shows the capabilities of the latest TerraForm provider, check https://github.com/Axual/terraform-provider-axual/tree/master/examples/axual.

## Import

Import is supported using the following syntax:

```shell
terraform import axual_application_deployment.<LOCAL NAME> <APPLICATION DEPLOYMENT UID>
terraform import axual_application_deployment.connector_axual_application_deployment 362f33655195493c9574fc18f5d9a701
```