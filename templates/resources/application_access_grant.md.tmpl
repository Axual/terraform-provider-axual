# {{.Name}} ({{.Type}})

{{ .Description | trimspace }}

## Note
- Application Access Grant cannot be edited
- Cancel grant by destroying application_access_grant
- Read more: https://docs.axual.io/axual/2025.3/self-service/topic-authorizations.html#contents

## Usage
- To request access to a topic, create an application_access_grant
- To cancel a grant, delete the application_access_grant
- Application Access Grant that are auto authorized do not need any further action.
- Application Access Grant that required further action can be handled with application_access_grant_approval and application_access_grant_rejection.

## Required Roles
- APPLICATION_ADMIN or be part of the Team that owns the Application

{{ .SchemaMarkdown | trimspace }}

## State Synchronization

~> **Important:** The `status` attribute is computed and may become stale when another resource modifies the grant.

### When Does This Happen?

When you create an `axual_application_access_grant_approval` or `axual_application_access_grant_rejection` resource, it changes the grant's status via the API. However, the grant resource's Terraform state is **not automatically updated** - it still shows the previous status until the next refresh.

**Example timeline:**

```
1. terraform apply (creates grant)     → state: status = "Pending"
2. terraform apply (creates approval)  → API changes grant to "Approved"
                                       → grant state still shows "Pending" (STALE)
3. terraform refresh (or next apply)   → state syncs: status = "Approved"
```

### How to Sync the State

Run any of these commands to refresh the grant's status from the API:

```shell
terraform refresh
# or
terraform apply   # refresh happens automatically at the start
# or
terraform plan    # refresh happens automatically at the start
```

### Why This Happens

This is expected Terraform behavior. When one resource modifies another resource via the API, Terraform's state for the modified resource is not automatically updated. The state is only synced during the refresh phase, which runs at the start of `plan`, `apply`, and `refresh` commands.

~> **Note:** In normal workflows, you won't notice this issue because Terraform automatically refreshes state before any `plan` or `apply`. The stale state only matters if you inspect the state file immediately after creating the approval/rejection resource.

## Example Usage

```hcl
resource "axual_application_access_grant" "dash_consume_from_logs_in_dev" {
  application = axual_application.dev_dashboard.id
  topic = axual_topic.logs.id
  environment = axual_environment.development.id
  access_type = "CONSUMER"
  depends_on = [
    axual_application_principal.log_scraper_in_dev_principal,
    axual_topic_config.logs_in_dev
  ]
}
```

For a full example which shows the capabilities of the latest TerraForm provider, check https://github.com/Axual/terraform-provider-axual/tree/master/examples/axual.

## Import

Application Access Grant can be imported using the grant's UID:

```shell
terraform import axual_application_access_grant.example 1234567890abcdef1234567890abcdef
```

### Notes

- The grant UID can be found in the Axual Self-Service UI or via the API
- All grant attributes (`application`, `topic`, `environment`, `access_type`, `status`) are populated during import
- Grants in any status (Pending, Approved, Rejected, Revoked, Cancelled) can be imported

### Delete Behavior

When deleting an `axual_application_access_grant`:

| Grant Status | Delete Action |
|--------------|---------------|
| Pending | Grant is cancelled |
| Approved | Grant is automatically revoked, then removed from state |
| Rejected | Grant is removed from state |
| Revoked | Grant is removed from state |
| Cancelled | Grant is removed from state |

This means you no longer need a separate `axual_application_access_grant_approval` resource just for cleanup in Auto environments - approved grants are auto-revoked on delete.